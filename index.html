<!DOCTYPE html>
<html lang="en">

<head>
    <title>INTO BIRTH</title>
    <link rel="icon" type="image/x-icon" sizes="32x32" href="./images/icons/icon.ico">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link type="text/css" rel="stylesheet" href="style.css">

    <!-- Fonts Import -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/typewriter-effect@latest/dist/core.js"></script>
    <script src=js/three.min.js></script>
    <script src=js/OrbitControls_1118.js></script>


</head>

<body>
    <div class="ui-container" style="display: none;">
        <div class="ui-item">.</div>
        <div class="ui-item">.</div>
        <div class="ui-item"><img src="./images/icons/LoadingPage_01.png"></div>
    </div>



    <!-- Loading Screen -->
    <div id="loading-screen">
        <img src="images/icons/LoadingPage_02.png" alt="LoadingTitle" class="loading-image" />
    </div>

    <!-- Control Instruction Screen -->
    <div id="instruction-screen" class="instruction-screen">
        <img class="info" class="hidden" id="instruction-image" src="" alt="Instruction"/>
        <img class="clickAreaInfoTop" id="topAreaShow" src="" alt="Top Area"/>
        <img class="clickAreaInfoBottom" id="bottomAreaShow" src="" alt="Bottom Area"/>
    </div>

    <!-- Instruction Text -->
    <div class="flex-container">
        <div class="text-container">
            <h1 id="khj3"></h1>
        </div>
    </div>

    <!-- Icon Button Container -->
    <div class="mute-button-container">
        <img id="muteIcon" src="images/icons/mute.svg" alt="Mute" class="mute-icon" style="display: none;" />
        <img id="unmuteIcon" src="images/icons/unmute.svg" alt="Unmute" class="mute-icon" />
    </div>
    <div class="info-button-container">
        <img id="instructionIcon" src="images/icons/questionMark.svg" alt="Instruction" class="mute-icon" />
        <img id="backIcon" src="images/icons/backArrow.svg" alt="Get Back" class="mute-icon" style="display: none;" />
    </div>

    <!-- Mobile Touch Area Container -->
    <div class="bottom-area"><img id="bottomArea" src="images/icons/transArea.png" class="clickArea" /></div>
    <div class="top-area"><img id="topArea" src="images/icons/transArea.png" class="clickArea" /></div>


    <!-- Panorama Scene -->
    <div class="three-container">
        <div class="scene"></div>
        <video id="video2" playsinline muted webkit-playsinline src="images/20241129_2k.mp4"
            style="display: none;"></video>
    </div>


    <!-- Audio elements with autoplay and muted -->
    <audio id="BGM_inWild" src="audio/BGM_EATEOT.mp3" autoplay muted loop preload></audio>

    <audio id="SFX_candleLitUp" src="audio/SFX_candleLitUp.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_candleBurn" src="audio/SFX_candleBurn.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_grassWave" src="audio/SFX_grassWave.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_grassGrow" src="audio/SFX_grassGrow.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_candleHum" src="audio/SFX_candleHumming.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_candleBlow" src="audio/SFX_candleBlow.mp3" autoplay muted loop preload></audio>

    <audio id="SFX_blowBreath" src="audio/SFX_blowBreath.mp3" autoplay muted loop></audio>
    <audio id="SFX_grassWaveTurnAround" src="audio/SFX_grassWaveTurnAround.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_pathExtend" src="audio/SFX_pathExtend.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_stepCandleBlow" src="audio/SFX_stepCandleBlow.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_turnAround" src="audio/SFX_turnAround.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_turnAround2" src="audio/SFX_turnAround2.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_windPeopleDis" src="audio/SFX_windPeopleDisappear.mp3" autoplay muted loop preload></audio>

    <audio id="BIRTH_Aunt" src="audio/Birth_Aunt.mp3" autoplay muted loop preload></audio>
    <audio id="BIRTH_Dad" src="audio/Birth_Dad.mp3" autoplay muted loop preload></audio>
    <audio id="BIRTH_Ella" src="audio/Birth_Ella.mp3" autoplay muted loop preload></audio>
    <audio id="BIRTH_Mom" src="audio/Birth_Mom.mp3" autoplay muted loop preload loop preload></audio>
    <audio id="BIRTH_Uncle" src="audio/Birth_Uncle.mp3" autoplay muted loop preload></audio>

    <audio id="SFX_step1" src="audio/SFX_step1.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_step2" src="audio/SFX_step2.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_step3" src="audio/SFX_step3.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_step4" src="audio/SFX_step4.mp3" autoplay muted loop preload></audio>

    <!-- Audio elements adjust volume for mobile only-->
    <audio id="BGM_inWild_s10" src="audio/forMobile/BGM_EATEOT_s10.mp3" autoplay muted loop preload></audio>
    <audio id="SFX_candleHum_s12" src="audio/forMobile/SFX_candleHumming_s12.mp3" autoplay muted loop preload></audio>



    <!-- Time line keyframe -->
    <script src="js/TimeLineKeyFrame.js"></script>

    <!-- Debugging Paremeter -->
    <script src="js/DEBUG.js"></script>

    <!-- Link audio and image file -->
    <script src="js/AudioElements.js"></script>
    <script src="js/StartnEndScene.js"></script>

    <!-- Tool set up -->
    <script src="js/IconControl.js"></script>
    <script src="js/PanoramaSetUp.js"></script>
    <script src="js/ControlSetUp.js"></script>
    <script src="js/VideoPlayer.js"></script>

    <!-- Elements Player -->
    <script src="js/AudioPlayer.js"></script>
    <script src="js/AudioHover.js"></script>
    <script src="js/TextPlayer.js"></script>



    <!-- Initialize scene -->
    <script>
        let container, camera, renderer, scene, controls;
        let initialCameraForward;
        let initialCameraPosition;
        let initialCameraRotation;
        let initialYawRotation;
        let rotateControl; // Declare in a higher scope
        const MobileDeviceOrNot = isMobileDevice();
        const sceneFOV = 90;

        function init() {
            setUpInstructionScreen();
            container = document.querySelector(".scene");

            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color('white');


            // Create camera
            const fov = sceneFOV;
            const aspect = container.clientWidth / container.clientHeight;
            const near = 0.01;
            const far = 4000;
            camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
            camera.position.set(0, 0, 0);// if change camera position, keys control will not work
            camera.rotation.z = Math.PI / 2;
            camera.fov = sceneFOV;

            // Variable to calculate the yaw rotation
            initialCameraForward = new THREE.Vector3(0, 0, -1); // Default forward vector in Three.js
            initialCameraPosition = camera.position.clone();
            initialCameraRotation = camera.rotation.clone(); // Capture the initial rotation
            initialYawRotation = camera.rotation.y;

            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            // Setup start textures and sphere geometry
            setupPanorama();
            setUpControl();
        }
        init();

        window.addEventListener("resize", () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });
    </script>

    <!-- Main controller -->
    <script src="js/FrameBasedControl.js"></script>


</body>


</html>